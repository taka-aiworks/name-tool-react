// src/components/CanvasArea/sceneTemplates.ts - types.tsæº–æ‹ ç‰ˆ
import { Character, SpeechBubble, BackgroundElement, EffectElement, ToneElement } from "../../types";

export interface EnhancedSceneTemplate {
  name: string;
  description: string;
  category: 'emotion' | 'action' | 'daily';
  characters: Omit<Character, "id">[];
  speechBubbles: Omit<SpeechBubble, "id">[];
  backgrounds?: Omit<BackgroundElement, "id">[];
  effects?: Omit<EffectElement, "id">[];
  tones?: Omit<ToneElement, "id">[];
}

// ğŸ­ æ„Ÿæƒ…ç³»ã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const emotionSceneTemplates: Record<string, EnhancedSceneTemplate> = {
  // ğŸ˜² é©šããƒ»ã‚·ãƒ§ãƒƒã‚¯ç³»
  surprise_shock: {
    name: "ğŸ˜² é©šããƒ»ã‚·ãƒ§ãƒƒã‚¯",
    description: "å¤§ããé©šã„ãŸç¬é–“ã®ã‚·ãƒ¼ãƒ³",
    category: 'emotion',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 280,
        y: 120,
        scale: 2.5,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "surprised",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "ãˆã£ï¼ï¼Ÿ",
        x: 150,
        y: 60,
        scale: 1.2,
        width: 80,
        height: 70,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "speed",
        x: 0.1,
        y: 0.1,
        width: 0.8,
        height: 0.8,
        direction: "radial",
        intensity: 0.8,
        density: 0.7,
        length: 30,
        angle: 0,
        color: "#333333",
        opacity: 0.6,
        blur: 0,
        selected: false,
        zIndex: 1,
        isGlobalPosition: false,
      },
    ],
    tones: [
      {
        panelId: 1,
        type: "dots",
        pattern: "dots_60",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 0.4,
        density: 0.5,
        opacity: 0.3,
        rotation: 0,
        scale: 1.0,
        blendMode: "multiply",
        contrast: 1.0,
        brightness: 0,
        invert: false,
        maskEnabled: false,
        maskShape: "rectangle",
        maskFeather: 0,
        selected: false,
        zIndex: 0,
        isGlobalPosition: false,
        visible: true,
      },
    ],
  },

  // ğŸ˜¢ æ‚²ã—ã¿ãƒ»æ¶™ç³»
  sadness_tears: {
    name: "ğŸ˜¢ æ‚²ã—ã¿ãƒ»æ¶™",
    description: "æ‚²ã—ã¿ã«æš®ã‚Œã‚‹æ„Ÿæƒ…è¡¨ç¾",
    category: 'emotion',
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 250,
        y: 120,
        scale: 2.3,
        facing: "front",
        gaze: "down",
        pose: "sitting",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "sad",
        bodyPose: "sitting",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å¿ƒã®å£°",
        text: "ã©ã†ã—ã¦...",
        x: 380,
        y: 60,
        scale: 1.0,
        width: 90,
        height: 70,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    backgrounds: [
      {
        panelId: 1,
        type: "gradient",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        rotation: 0,
        zIndex: -1,
        opacity: 0.4,
        gradientType: "linear",
        gradientColors: ["#cccccc", "#888888"],
        gradientDirection: 270,
      },
    ],
    tones: [
      {
        panelId: 1,
        type: "lines",
        pattern: "lines_diagonal",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        density: 0.4,
        opacity: 0.3,
        rotation: 45,
        scale: 1.0,
        blendMode: "multiply",
        contrast: 1.0,
        brightness: 0,
        invert: false,
        maskEnabled: false,
        maskShape: "rectangle",
        maskFeather: 0,
        selected: false,
        zIndex: 0,
        isGlobalPosition: false,
        visible: true,
      },
    ],
  },

  // ğŸ˜¡ æ€’ã‚Šãƒ»æ¿€æƒ…ç³»
  anger_fury: {
    name: "ğŸ˜¡ æ€’ã‚Šãƒ»æ¿€æƒ…",
    description: "æ¿€ã—ã„æ€’ã‚Šã®è¡¨ç¾",
    category: 'emotion',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 200,
        y: 130,
        scale: 2.2,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "angry",
        bodyPose: "arms_crossed",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "è¨±ã›ãªã„ï¼",
        x: 80,
        y: 60,
        scale: 1.3,
        width: 100,
        height: 80,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "explosion",
        x: 0.15,
        y: 0.15,
        width: 0.7,
        height: 0.7,
        direction: "radial",
        intensity: 0.9,
        density: 0.8,
        length: 25,
        angle: 0,
        color: "#ff4444",
        opacity: 0.8,
        blur: 1,
        selected: false,
        zIndex: 2,
        isGlobalPosition: false,
      },
    ],
    tones: [
      {
        panelId: 1,
        type: "dots",
        pattern: "dots_85",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        density: 0.6,
        opacity: 0.4,
        rotation: 0,
        scale: 1.2,
        blendMode: "multiply",
        contrast: 1.2,
        brightness: 0,
        invert: false,
        maskEnabled: false,
        maskShape: "rectangle",
        maskFeather: 0,
        selected: false,
        zIndex: 0,
        isGlobalPosition: false,
        visible: true,
      },
    ],
  },

  // ğŸ˜„ å–œã³ãƒ»å¹¸ã›ç³»
  joy_happiness: {
    name: "ğŸ˜„ å–œã³ãƒ»å¹¸ã›",
    description: "æ˜ã‚‹ãæ¥½ã—ã„ç¬é–“",
    category: 'emotion',
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 150,
        y: 120,
        scale: 2.0,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "smile",
        bodyPose: "waving",
      },
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 400,
        y: 120,
        scale: 2.0,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "smile",
        bodyPose: "pointing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ã‚„ã£ãŸã­ï¼",
        x: 80,
        y: 70,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ã†ã‚“â™ª",
        x: 450,
        y: 65,
        scale: 1.0,
        width: 70,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    backgrounds: [
      {
        panelId: 1,
        type: "gradient",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        rotation: 0,
        zIndex: -1,
        opacity: 0.5,
        gradientType: "linear",
        gradientColors: ["#87CEEB", "#F0F8FF"],
        gradientDirection: 180,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "flash",
        x: 0.2,
        y: 0.2,
        width: 0.6,
        height: 0.6,
        direction: "radial",
        intensity: 0.7,
        density: 0.6,
        length: 20,
        angle: 0,
        color: "#ffdd44",
        opacity: 0.7,
        blur: 2,
        selected: false,
        zIndex: 1,
        isGlobalPosition: false,
      },
    ],
  },

  // ğŸ˜³ æ¥ãšã‹ã—ãŒã‚Šç³»
  embarrassed_shy: {
    name: "ğŸ˜³ æ¥ãšã‹ã—ãŒã‚Š",
    description: "ç…§ã‚Œã¦ã„ã‚‹å¯æ„›ã‚‰ã—ã„è¡¨æƒ…",
    category: 'emotion',
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 280,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "down",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "rightFront",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "rightFront",
        faceExpression: "embarrassed",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å°å£°",
        text: "ã‚ã®...",
        x: 150,
        y: 70,
        scale: 0.9,
        width: 60,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "flash",
        x: 0.35,
        y: 0.25,
        width: 0.3,
        height: 0.2,
        direction: "radial",
        intensity: 0.6,
        density: 0.5,
        length: 15,
        angle: 0,
        color: "#ff8888",
        opacity: 0.8,
        blur: 3,
        selected: false,
        zIndex: 1,
        isGlobalPosition: false,
      },
    ],
  },
};

// ğŸš€ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç³»ã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const actionSceneTemplates: Record<string, EnhancedSceneTemplate> = {
  // ğŸ’¨ èµ°ã‚‹ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ç³»
  running_speed: {
    name: "ğŸ’¨ èµ°ã‚‹ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰",
    description: "ç–¾èµ°æ„Ÿã‚ãµã‚Œã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
    category: 'action',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 200,
        y: 140,
        scale: 2.3,
        facing: "front",
        gaze: "right",
        pose: "running",
        expression: "neutral",
        viewType: "fullBody",
        faceAngle: "right",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "right",
        faceExpression: "normal",
        bodyPose: "running",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "æ€¥ã’ï¼",
        x: 80,
        y: 60,
        scale: 1.1,
        width: 70,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "speed",
        x: 0.0,
        y: 0.3,
        width: 0.6,
        height: 0.4,
        direction: "horizontal",
        intensity: 0.8,
        density: 0.9,
        length: 40,
        angle: 10,
        color: "#666666",
        opacity: 0.7,
        blur: 1,
        selected: false,
        zIndex: 1,
        isGlobalPosition: false,
      },
    ],
  },

  // âœŠ æˆ¦é—˜ãƒ»ãƒãƒˆãƒ«ç³»
  battle_fight: {
    name: "âœŠ æˆ¦é—˜ãƒ»ãƒãƒˆãƒ«",
    description: "æ¿€ã—ã„æˆ¦é—˜ã‚·ãƒ¼ãƒ³",
    category: 'action',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 150,
        y: 130,
        scale: 2.4,
        facing: "front",
        gaze: "right",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "right",
        eyeDirection: "right",
        isGlobalPosition: true,
        bodyDirection: "right",
        faceExpression: "angry",
        bodyPose: "pointing",
      },
      {
        panelId: 1,
        type: "rival",
        name: "ãƒ©ã‚¤ãƒãƒ«",
        x: 420,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "angry",
        bodyPose: "arms_crossed",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "è¡Œããï¼",
        x: 70,
        y: 60,
        scale: 1.2,
        width: 80,
        height: 70,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "å«ã³",
        text: "æ¥ã„ï¼",
        x: 480,
        y: 65,
        scale: 1.1,
        width: 70,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "explosion",
        x: 0.3,
        y: 0.2,
        width: 0.4,
        height: 0.6,
        direction: "radial",
        intensity: 0.9,
        density: 0.8,
        length: 30,
        angle: 0,
        color: "#ff6666",
        opacity: 0.8,
        blur: 0,
        selected: false,
        zIndex: 2,
        isGlobalPosition: false,
      },
    ],
    tones: [
      {
        panelId: 1,
        type: "lines",
        pattern: "lines_vertical",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        density: 0.7,
        opacity: 0.4,
        rotation: 0,
        scale: 1.0,
        blendMode: "multiply",
        contrast: 1.1,
        brightness: 0,
        invert: false,
        maskEnabled: false,
        maskShape: "rectangle",
        maskFeather: 0,
        selected: false,
        zIndex: 0,
        isGlobalPosition: false,
        visible: true,
      },
    ],
  },

  // ğŸ’« è¡æ’ƒãƒ»ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆç³»
  shock_impact: {
    name: "ğŸ’« è¡æ’ƒãƒ»ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ",
    description: "å¼·çƒˆãªè¡æ’ƒã®ç¬é–“",
    category: 'action',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 280,
        y: 140,
        scale: 2.0,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "surprised",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "ã†ã‚ã‚ï¼",
        x: 150,
        y: 60,
        scale: 1.4,
        width: 90,
        height: 80,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "speed",
        x: 0.1,
        y: 0.1,
        width: 0.8,
        height: 0.8,
        direction: "radial",
        intensity: 1.0,
        density: 0.9,
        length: 35,
        angle: 0,
        color: "#333333",
        opacity: 0.9,
        blur: 0,
        selected: false,
        zIndex: 3,
        isGlobalPosition: false,
      },
      {
        panelId: 1,
        type: "explosion",
        x: 0.2,
        y: 0.2,
        width: 0.6,
        height: 0.6,
        direction: "radial",
        intensity: 0.8,
        density: 0.7,
        length: 25,
        angle: 45,
        color: "#ffaa44",
        opacity: 0.7,
        blur: 1,
        selected: false,
        zIndex: 2,
        isGlobalPosition: false,
      },
    ],
  },
};

// ğŸ  æ—¥å¸¸ç³»ã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const dailySceneTemplates: Record<string, EnhancedSceneTemplate> = {
  // ğŸ« å­¦æ ¡ãƒ»æ•™å®¤ç³»
  school_classroom: {
    name: "ğŸ« å­¦æ ¡ãƒ»æ•™å®¤",
    description: "å­¦æ ¡ã§ã®æ—¥å¸¸ã‚·ãƒ¼ãƒ³",
    category: 'daily',
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 120,
        y: 130,
        scale: 2.0,
        facing: "front",
        gaze: "right",
        pose: "sitting",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "right",
        eyeDirection: "right",
        isGlobalPosition: true,
        bodyDirection: "right",
        faceExpression: "normal",
        bodyPose: "sitting",
      },
      {
        panelId: 1,
        type: "friend",
        name: "å‹äºº",
        x: 430,
        y: 130,
        scale: 2.0,
        facing: "front",
        gaze: "left",
        pose: "sitting",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "smile",
        bodyPose: "sitting",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "å®¿é¡Œã‚„ã£ãŸï¼Ÿ",
        x: 80,
        y: 70,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ã‚„ã°ã„...",
        x: 480,
        y: 65,
        scale: 1.0,
        width: 70,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    backgrounds: [
      {
        panelId: 1,
        type: "pattern",
        x: 0.0,
        y: 0.0,
        width: 1.0,
        height: 1.0,
        rotation: 0,
        zIndex: -1,
        opacity: 0.6,
        patternType: "grid",
        patternColor: "#cccccc",
        patternSize: 20,
        patternSpacing: 5,
      },
    ],
  },

  // ğŸ• é£Ÿäº‹ãƒ»ã‚°ãƒ«ãƒ¡ç³»
  eating_meal: {
    name: "ğŸ• é£Ÿäº‹ãƒ»ã‚°ãƒ«ãƒ¡",
    description: "ç¾å‘³ã—ã„é£Ÿäº‹ã®ã‚·ãƒ¼ãƒ³",
    category: 'daily',
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 280,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "down",
        pose: "sitting",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "smile",
        bodyPose: "sitting",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ç¾å‘³ã—ã„â™ª",
        x: 150,
        y: 60,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
    effects: [
      {
        panelId: 1,
        type: "flash",
        x: 0.3,
        y: 0.3,
        width: 0.4,
        height: 0.4,
        direction: "radial",
        intensity: 0.6,
        density: 0.5,
        length: 15,
        angle: 0,
        color: "#ffdd88",
        opacity: 0.6,
        blur: 2,
        selected: false,
        zIndex: 1,
        isGlobalPosition: false,
      },
    ],
  },
};

// ğŸ¯ çµ±åˆé–¢æ•°ç¾¤
export const getAllSceneTemplates = (): Record<string, EnhancedSceneTemplate> => {
  return {
    ...emotionSceneTemplates,
    ...actionSceneTemplates,
    ...dailySceneTemplates,
  };
};

export const getTemplatesByCategory = (category: 'emotion' | 'action' | 'daily'): Record<string, EnhancedSceneTemplate> => {
  const allTemplates = getAllSceneTemplates();
  const filtered: Record<string, EnhancedSceneTemplate> = {};
  
  Object.entries(allTemplates).forEach(([key, template]) => {
    if (template.category === category) {
      filtered[key] = template;
    }
  });
  
  return filtered;
};

// ğŸš€ çµ±åˆã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨é–¢æ•°
export const applyEnhancedSceneTemplate = (
  templateKey: string,
  panels: any[],
  existingCharacters: any[],
  existingSpeechBubbles: any[],
  existingBackgrounds: any[],
  existingEffects: any[],
  existingTones: any[],
  selectedPanel?: any
): {
  characters: any[];
  speechBubbles: any[];
  backgrounds: any[];
  effects: any[];
  tones: any[];
} => {
  const template = getAllSceneTemplates()[templateKey];
  if (!template || panels.length === 0) {
    return {
      characters: existingCharacters,
      speechBubbles: existingSpeechBubbles,
      backgrounds: existingBackgrounds,
      effects: existingEffects,
      tones: existingTones,
    };
  }

  const targetPanel = selectedPanel || panels[0];
  const panelOffsetX = targetPanel.x;
  const panelOffsetY = targetPanel.y;

  console.log(`ğŸ­ çµ±åˆã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨: ${template.name} â†’ ãƒ‘ãƒãƒ«${targetPanel.id}`);

  // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”Ÿæˆ
  const newCharacters = template.characters.map((char) => ({
    ...char,
    id: `char_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
    x: char.x + panelOffsetX,
    y: char.y + panelOffsetY,
  }));

  // å¹ãå‡ºã—ç”Ÿæˆ
  const newSpeechBubbles = template.speechBubbles.map((bubble) => ({
    ...bubble,
    id: `bubble_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
    x: bubble.x + panelOffsetX,
    y: bubble.y + panelOffsetY,
  }));

  // èƒŒæ™¯ç”Ÿæˆ
  const newBackgrounds = (template.backgrounds || []).map((bg) => ({
    ...bg,
    id: `bg_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
  }));

  // åŠ¹æœç·šç”Ÿæˆ
  const newEffects = (template.effects || []).map((effect) => ({
    ...effect,
    id: `effect_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
  }));

  // ãƒˆãƒ¼ãƒ³ç”Ÿæˆ
  const newTones = (template.tones || []).map((tone) => ({
    ...tone,
    id: `tone_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
  }));

  console.log(`âœ… çµ±åˆè¦ç´ è¿½åŠ : ã‚­ãƒ£ãƒ©${newCharacters.length}å€‹ã€å¹ãå‡ºã—${newSpeechBubbles.length}å€‹ã€èƒŒæ™¯${newBackgrounds.length}å€‹ã€åŠ¹æœç·š${newEffects.length}å€‹ã€ãƒˆãƒ¼ãƒ³${newTones.length}å€‹`);

  return {
    characters: [...existingCharacters, ...newCharacters],
    speechBubbles: [...existingSpeechBubbles, ...newSpeechBubbles],
    backgrounds: [...existingBackgrounds, ...newBackgrounds],
    effects: [...existingEffects, ...newEffects],
    tones: [...existingTones, ...newTones],
  };
};

// æ—¢å­˜ã®ã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
export interface SceneTemplate {
  characters: Omit<Character, "id">[];
  speechBubbles: Omit<SpeechBubble, "id">[];
}

export const sceneTemplates: Record<string, SceneTemplate> = {
  daily: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 120,
        y: 130,
        scale: 2.0,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "normal",
        bodyPose: "standing",
      },
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 430,
        y: 130,
        scale: 2.0,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "normal",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ãŠã¯ã‚ˆã†ï¼",
        x: 80,
        y: 70,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ãŠã¯ã‚ˆã†",
        x: 480,
        y: 65,
        scale: 1.0,
        width: 70,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  dialogue: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 100,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "right",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "right",
        eyeDirection: "right",
        isGlobalPosition: true,
        bodyDirection: "right",
        faceExpression: "normal",
        bodyPose: "standing",
      },
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 480,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "normal",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ä½•ã‹è©±ãã†ã‹",
        x: 60,
        y: 60,
        scale: 1.0,
        width: 90,
        height: 70,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ãã†ã­",
        x: 520,
        y: 55,
        scale: 1.0,
        width: 60,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  action: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 300,
        y: 140,
        scale: 2.5,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "fullBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "normal",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "ã„ããï¼",
        x: 150,
        y: 60,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  emotional: {
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 250,
        y: 120,
        scale: 2.3,
        facing: "front",
        gaze: "down",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "front",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "sad",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å¿ƒã®å£°",
        text: "ã©ã†ã—ã‚ˆã†...",
        x: 380,
        y: 60,
        scale: 1.0,
        width: 90,
        height: 70,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  comedy: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 140,
        y: 130,
        scale: 2.2,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "front",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "surprised",
        bodyPose: "standing",
      },
      {
        panelId: 1,
        type: "friend",
        name: "å‹äºº",
        x: 410,
        y: 130,
        scale: 2.2,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "left",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "left",
        faceExpression: "smile",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "ãªã‚“ã¦ã“ã£ãŸï¼",
        x: 80,
        y: 60,
        scale: 1.0,
        width: 100,
        height: 80,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ã¾ã‚ã¾ã‚",
        x: 460,
        y: 65,
        scale: 1.0,
        width: 70,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  romance: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 150,
        y: 120,
        scale: 2.0,
        facing: "front",
        gaze: "right",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "rightFront",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "rightFront",
        faceExpression: "embarrassed",
        bodyPose: "standing",
      },
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 400,
        y: 120,
        scale: 2.0,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "leftFront",
        eyeDirection: "down",
        isGlobalPosition: true,
        bodyDirection: "leftFront",
        faceExpression: "embarrassed",
        bodyPose: "standing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å°å£°",
        text: "ã‚ã®...",
        x: 100,
        y: 70,
        scale: 1.0,
        width: 60,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "å¿ƒã®å£°",
        text: "ãƒ‰ã‚­ãƒ‰ã‚­...",
        x: 450,
        y: 60,
        scale: 1.0,
        width: 70,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  tension: {
    characters: [
      {
        panelId: 1,
        type: "hero",
        name: "ä¸»äººå…¬",
        x: 200,
        y: 130,
        scale: 2.0,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "back",
        eyeDirection: "front",
        isGlobalPosition: true,
        bodyDirection: "back",
        faceExpression: "worried",
        bodyPose: "standing",
      },
      {
        panelId: 1,
        type: "rival",
        name: "ãƒ©ã‚¤ãƒãƒ«",
        x: 380,
        y: 120,
        scale: 2.2,
        facing: "front",
        gaze: "left",
        pose: "standing",
        expression: "neutral",
        viewType: "halfBody",
        faceAngle: "leftBack",
        eyeDirection: "left",
        isGlobalPosition: true,
        bodyDirection: "leftBack",
        faceExpression: "angry",
        bodyPose: "arms_crossed",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å¿ƒã®å£°",
        text: "æ°—é…ãŒ...",
        x: 120,
        y: 60,
        scale: 1.0,
        width: 80,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
      {
        panelId: 1,
        type: "æ™®é€š",
        text: "ãƒ•ãƒƒ...",
        x: 450,
        y: 70,
        scale: 1.0,
        width: 60,
        height: 50,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
  surprise: {
    characters: [
      {
        panelId: 1,
        type: "heroine",
        name: "ãƒ’ãƒ­ã‚¤ãƒ³",
        x: 280,
        y: 120,
        scale: 2.5,
        facing: "front",
        gaze: "center",
        pose: "standing",
        expression: "neutral",
        viewType: "face",
        faceAngle: "front",
        eyeDirection: "up",
        isGlobalPosition: true,
        bodyDirection: "front",
        faceExpression: "surprised",
        bodyPose: "pointing",
      },
    ],
    speechBubbles: [
      {
        panelId: 1,
        type: "å«ã³",
        text: "ãˆã£ï¼ï¼Ÿ",
        x: 150,
        y: 60,
        scale: 1.0,
        width: 70,
        height: 60,
        vertical: true,
        isGlobalPosition: true,
      },
    ],
  },
};

// æ—¢å­˜ã®applySceneTemplateé–¢æ•°ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰
export const applySceneTemplate = (
  sceneType: string,
  panels: any[],
  existingCharacters: Character[],
  existingSpeechBubbles: SpeechBubble[],
  selectedPanel?: any
): { characters: Character[], speechBubbles: SpeechBubble[] } => {
  const template = sceneTemplates[sceneType];
  if (!template || panels.length === 0) {
    return { characters: existingCharacters, speechBubbles: existingSpeechBubbles };
  }

  const targetPanel = selectedPanel || panels[0];
  const panelOffsetX = targetPanel.x;
  const panelOffsetY = targetPanel.y;

  console.log(`ğŸ­ ã‚·ãƒ¼ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨: ${sceneType} â†’ ãƒ‘ãƒãƒ«${targetPanel.id}`);

  const newCharacters = template.characters.map((char) => ({
    ...char,
    id: `char_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
    x: char.x + panelOffsetX,
    y: char.y + panelOffsetY,
  }));

  const newSpeechBubbles = template.speechBubbles.map((bubble) => ({
    ...bubble,
    id: `bubble_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,
    panelId: targetPanel.id,
    x: bubble.x + panelOffsetX,
    y: bubble.y + panelOffsetY,
  }));

  console.log(`âœ… æ–°è¦è¦ç´ è¿½åŠ : ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${newCharacters.length}å€‹ã€å¹ãå‡ºã—${newSpeechBubbles.length}å€‹`);

  return {
    characters: [...existingCharacters, ...newCharacters],
    speechBubbles: [...existingSpeechBubbles, ...newSpeechBubbles],
  };
};